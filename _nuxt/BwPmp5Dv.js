import{e as B,r as a,u as N,f as $,g as O,c as k,o as x,a as l,h as V,i as p,v as f,t as M,_ as P}from"./CBXstaJA.js";import{s as _}from"./BC1oVRab.js";const h={class:"form-container"},q={class:"form-field"},z={class:"form-field"},A={class:"form-field"},F={class:"form-field"},H={class:"form-field"},L={class:"form-field"},R=["disabled"],j={key:0,style:{color:"green","margin-top":"1rem"}},G={key:1,style:{color:"red","margin-top":"1rem"}},J=B({__name:"admin",setup(K){const i=a(""),g=a(""),v=a(""),w=a(""),r=a(""),d=a(""),c=a(""),o=a(null),s=a(!1);let y;const{$toastEditor:S}=N(),C=$(),m=a(""),n=a("");function T(u){return u.replace(/!\[.*?\]\(.*?\)/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/[#>*_~\-]+/g,"").replace(/\n/g," ").trim()}O(()=>{S?y=new S({el:document.querySelector("#editor"),height:"300px",initialEditType:"markdown",previewStyle:"vertical",events:{change:()=>{v.value=y.getMarkdown(),w.value=y.getHTML()}}}):console.error("❌ toastEditor 尚未載入"),r.value=new Date().toISOString().split("T")[0]});const D=u=>{var t;const e=u.target;(t=e.files)!=null&&t.length&&(o.value=e.files[0])},E=async()=>{if(s.value)return;if(s.value=!0,!i.value||!v.value||!r.value||!d.value){n.value="❌ 請填寫所有必填欄位",m.value="",s.value=!1;return}if(o.value&&o.value.size>2*1024*1024){n.value="❌ 圖片大小不能超過 2MB",s.value=!1;return}let u="";if(o.value){const b=`${Date.now()}_${o.value.name}`,{error:U}=await _.storage.from("post-images").upload(b,o.value);if(U){n.value="❌ 圖片上傳失敗："+U.message,s.value=!1;return}const{data:I}=_.storage.from("post-images").getPublicUrl(b);u=I.publicUrl}const e=g.value.trim()||T(v.value).slice(0,100),{error:t}=await _.from("posts").insert([{title:i.value,summary:e,content:v.value,html:w.value,date:r.value,author:d.value,tags:c.value.split(",").map(b=>b.trim()),image_url:u}]);t?(n.value=t.message,m.value=""):(m.value="✅ 文章發布成功！",n.value="",i.value="",g.value="",v.value="",w.value="",r.value=new Date().toISOString().split("T")[0],d.value="",c.value="",o.value=null,y.setMarkdown(""),setTimeout(()=>{C.push("/posts")},1500)),s.value=!1};return(u,e)=>(x(),k("div",h,[e[11]||(e[11]=l("h1",null,"新增文章",-1)),l("div",q,[e[5]||(e[5]=l("label",null,"標題 *",-1)),p(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),type:"text"},null,512),[[f,i.value]])]),l("div",z,[e[6]||(e[6]=l("label",null,"描述 / 摘要（可選填）",-1)),p(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),rows:"3",placeholder:"請輸入文章描述..."},null,512),[[f,g.value]])]),e[12]||(e[12]=l("div",{class:"form-field"},[l("label",null,"內容（支援 Markdown） *"),l("div",{id:"editor"})],-1)),l("div",A,[e[7]||(e[7]=l("label",null,"日期 *",-1)),p(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.value=t),type:"date"},null,512),[[f,r.value]])]),l("div",F,[e[8]||(e[8]=l("label",null,"作者 *",-1)),p(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t),type:"text"},null,512),[[f,d.value]])]),l("div",H,[e[9]||(e[9]=l("label",null,"標籤（用 , 分隔）",-1)),p(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>c.value=t),type:"text"},null,512),[[f,c.value]])]),l("div",L,[e[10]||(e[10]=l("label",null,"上傳封面圖片",-1)),l("input",{type:"file",accept:"image/*",onChange:D},null,32)]),l("button",{disabled:s.value,onClick:E},M(s.value?"發佈中...":"🚀 發佈文章"),9,R),m.value?(x(),k("p",j,M(m.value),1)):V("",!0),n.value?(x(),k("p",G,M(n.value),1)):V("",!0)]))}}),X=P(J,[["__scopeId","data-v-727ccc8a"]]);export{X as default};
